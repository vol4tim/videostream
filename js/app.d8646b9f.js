(function(){var t={7662:function(t,e,n){"use strict";var o=n(5361),i=n(9242),s=n(3396),r=n(7139);const a=(0,s._)("div",{class:"header"},[(0,s._)("div",{class:"item"},[(0,s._)("h1",null,"Video stream")])],-1),c={class:"block"},l={class:"block"},d=["href"],u={key:0,class:"block"},h={key:1,class:"block"};function f(t,e,n,o,i,f){const p=(0,s.up)("find-video-form"),y=(0,s.up)("ipfs-auth"),g=(0,s.up)("ipfs-files"),w=(0,s.up)("video-content");return(0,s.wg)(),(0,s.iD)(s.HY,null,[a,(0,s._)("div",null,[i.isReady?((0,s.wg)(),(0,s.iD)(s.HY,{key:0},[(0,s._)("div",c,[(0,s.Wm)(p,{onVideo:f.handlerFindVideo},null,8,["onVideo"])]),i.videoCid?((0,s.wg)(),(0,s.iD)(s.HY,{key:0},[(0,s._)("div",l,[(0,s.Uk)(" Result: "),(0,s._)("a",{href:`https://${t.$ipfs_gateway}/ipfs/${i.videoCid}`,target:"_blank"},(0,r.zw)(i.videoCid),9,d)]),i.videoCid?((0,s.wg)(),(0,s.iD)("div",u,[(0,s.Wm)(y,{onAuth:f.handlerAuth},null,8,["onAuth"]),i.ipfsAuth?((0,s.wg)(),(0,s.j4)(g,{key:0,controller:i.videoController,cid:i.videoCid,onPlay:f.handlerPlay},null,8,["controller","cid","onPlay"])):(0,s.kq)("",!0)])):(0,s.kq)("",!0),i.videoContent||i.videoIsLoad?((0,s.wg)(),(0,s.iD)("div",h,[(0,s.Wm)(w,{isLoad:i.videoIsLoad,content:i.videoContent},null,8,["isLoad","content"])])):(0,s.kq)("",!0)],64)):(0,s.kq)("",!0)],64)):((0,s.wg)(),(0,s.iD)(s.HY,{key:1},[(0,s.Uk)("...")],64))])],64)}const p={style:{"margin-top":"20px"}},y=["disabled"];function g(t,e,n,o,r,a){return(0,s.wg)(),(0,s.iD)(s.HY,null,[(0,s._)("div",null,[(0,s.Uk)(" Controller "),(0,s.wy)((0,s._)("input",{"onUpdate:modelValue":e[0]||(e[0]=t=>r.controller=t)},null,512),[[i.nr,r.controller]])]),(0,s._)("div",p,[(0,s._)("button",{onClick:e[1]||(e[1]=(...t)=>a.find&&a.find(...t)),disabled:!a.isValidAddress||r.load},[(0,s.Uk)(" Find twins"),r.load?((0,s.wg)(),(0,s.iD)(s.HY,{key:0},[(0,s.Uk)(" ...")],64)):(0,s.kq)("",!0)],8,y)])],64)}n(7658);var w=n(7665),v=n(3162),m=n(5154),b=n(9361),k=n(2094);const _=t=>{try{return(0,w.m)((0,m.vq)(t)?(0,b.G)(t):(0,v.m)(t)),!0}catch(e){return!1}},A=async(t,e)=>{const n=[],o=await t.twin.getTotal();for(let i=0;i<o;i++){const o=await t.twin.getOwner(i);o===e&&n.push(i)}return n},$=async(t,e)=>{try{const n=await t.twin.getTwin(e);if(n){const t=Object.keys(n).find((t=>"4CC7GkKuJJzFzswqz39m5qWbgXaQks9f36jCgsadpN2c1hnh"===n[t]));if(t)return k.P6.hexToCid(t)}}catch(n){console.log(n)}};var C={emits:["video"],data(){return{controller:"",load:!1}},computed:{isValidAddress(){return _(this.controller)}},methods:{async find(){this.load=!0,this.$emit("video");try{const t=await A(this.$robonomics,this.controller);if(t.length>0){const e=await $(this.$robonomics,t[t.length-1]);this.$emit("video",{controller:this.controller,cid:e})}}catch(t){console.log(t)}this.load=!1}}},O=n(89);const P=(0,O.Z)(C,[["render",g]]);var D=P;function L(t,e,n,o,i,r){const a=(0,s.up)("account");return(0,s.wg)(),(0,s.iD)(s.HY,null,[(0,s.Wm)(a),i.isAuth?(0,s.kq)("",!0):((0,s.wg)(),(0,s.iD)("button",{key:0,onClick:e[0]||(e[0]=(...t)=>r.ipfsAuth&&r.ipfsAuth(...t))},"ipfs auth"))],64)}var j=n(2273);const V=["value"],I=(0,s._)("br",null,null,-1);function M(t,e,n,o,a,c){return(0,s.wg)(),(0,s.iD)("div",null,[(0,s.Uk)(" Account: "),a.isReady?((0,s.wg)(),(0,s.iD)(s.HY,{key:0},[(0,s.wy)((0,s._)("select",{"onUpdate:modelValue":e[0]||(e[0]=t=>a.account=t)},[((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(a.accounts,((t,e)=>((0,s.wg)(),(0,s.iD)("option",{key:e,value:t.address},(0,r.zw)(t.meta.isTesting?"dev":"")+" "+(0,r.zw)(t.meta.name)+" | "+(0,r.zw)(t.meta?.source),9,V)))),128))],512),[[i.bM,a.account]]),I,(0,s.Uk)(" "+(0,r.zw)(a.account),1)],64)):((0,s.wg)(),(0,s.iD)("button",{key:1,onClick:e[1]||(e[1]=(...t)=>c.connect&&c.connect(...t))},"connect")),(0,s._)("p",null,(0,r.zw)(a.error),1)])}var H={data(){return{isReady:!1,account:null,accounts:[],error:""}},created(){this.connect(),this.$robonomics.accountManager.onReady((()=>{this.isReady=!0}))},watch:{async account(t){await this.$robonomics.accountManager.setSender(t)}},methods:{async connect(){this.error="";try{await this.$robonomics.accountManager.initPlugin({isDevelopment:!1}),this.accounts=this.$robonomics.accountManager.getAccounts(),this.accounts.length&&(this.account=this.accounts[0].address)}catch(t){this.error=t.message}}}};const U=(0,O.Z)(H,[["render",M]]);var Y=U,x={emits:["auth"],components:{Account:Y},data(){return{isAuth:!1}},created(){this.$robonomics.accountManager.onChange((()=>{this.isAuth=!1}))},watch:{isAuth(){this.$emit("auth",this.isAuth)}},methods:{async ipfsAuth(){try{const t=(await this.$robonomics.accountManager.account.signMsg((0,j.d)(this.$robonomics.accountManager.account.address))).toString();this.$ipfs.auth(this.$robonomics.accountManager.account.address,t),this.isAuth=!0}catch(t){console.log(t)}}}};const R=(0,O.Z)(x,[["render",L]]);var F=R;const T={key:0},z={style:{margin:"20px 0"}},S={class:"input-container"},q=["type"],W=["href"],E=["disabled","onClick"];function Z(t,e,n,o,a,c){return a.isLoadFiles?((0,s.wg)(),(0,s.iD)("div",T,"...")):a.files.length>0?((0,s.wg)(),(0,s.iD)(s.HY,{key:1},[(0,s._)("div",z,[(0,s.Uk)(" Controller seed for decrypt video: "),(0,s._)("div",S,[(0,s.wy)((0,s._)("input",{type:a.typeInput,"onUpdate:modelValue":e[0]||(e[0]=t=>a.seed=t),class:"input-box"},null,8,q),[[i.YZ,a.seed]]),(0,s._)("button",{class:"input-box",onClick:e[1]||(e[1]=(...t)=>c.togglePassword&&c.togglePassword(...t))},(0,r.zw)("password"===a.typeInput?"show":"hide"),1)])]),((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(a.files,((e,n)=>((0,s.wg)(),(0,s.iD)("div",{key:n},[(0,s._)("a",{href:`https://${t.$ipfs_gateway}/ipfs/${e.path}`,target:"_blank"},(0,r.zw)(e.name),9,W),(0,s._)("button",{disabled:!c.isValidASeed||a.isLoadVideo,onClick:t=>c.play(e.cid)}," play ",8,E)])))),128))],64)):((0,s.wg)(),(0,s.iD)("button",{key:2,onClick:e[2]||(e[2]=t=>c.ls(n.cid))},"Get files"))}var B=n(3957),G={props:["controller","cid"],emits:["play"],data(){return{seed:"",files:[],isLoadFiles:!1,isLoadVideo:!1,typeInput:"password"}},async created(){this.ls(this.cid)},computed:{isValidASeed(){return null!==this.controllerAccount(this.seed)}},methods:{async ls(t){this.isLoadFiles=!0;try{this.files=await this.$ipfs.ls(t)}catch(e){console.log(e)}this.isLoadFiles=!1},async play(t){this.isLoadVideo=!0,this.$emit("play",{isLoad:!0,content:null});try{const e=await this.$ipfs.cat(t),n=this.decrypt(e);this.$emit("play",{isLoad:!1,content:n})}catch(e){console.log(e),this.$emit("play",{isLoad:!1,content:null})}this.isLoadVideo=!1},controllerAccount(t){if(t)try{const e=new B.Y({ss58Format:32}),n=e.addFromUri(t,{},"ed25519");if(n.address===this.controller)return n}catch(e){console.log(e)}return null},decrypt(t){const e=this.controllerAccount(this.seed),n=e.decryptMessage(t,e.publicKey);return n},togglePassword(){this.typeInput="password"===this.typeInput?"text":"password"}}};const K=(0,O.Z)(G,[["render",Z],["__scopeId","data-v-21ec28b6"]]);var N=K;const J={key:0},Q={id:"video",width:"600",height:"480",controls:"",muted:"muted"};function X(t,e,n,o,r,a){return(0,s.wg)(),(0,s.iD)(s.HY,null,[n.isLoad?((0,s.wg)(),(0,s.iD)("div",J,"...")):(0,s.kq)("",!0),(0,s.wy)((0,s._)("video",Q,null,512),[[i.F8,!n.isLoad]])],64)}var tt={props:["isLoad","content"],mounted(){this.loadVideo(this.content)},watch:{content(){this.loadVideo(this.content)}},methods:{loadVideo(t){if(!t)return;const e=document.getElementById("video"),n=new Blob([t],{type:"video/mp4"});e.src=URL.createObjectURL(n),e.load()}}};const et=(0,O.Z)(tt,[["render",X]]);var nt=et,ot={name:"App",components:{IpfsAuth:F,IpfsFiles:N,FindVideoForm:D,VideoContent:nt},data(){return{isReady:!1,videoCid:null,videoController:null,videoIsLoad:!1,videoContent:null,ipfsAuth:!1}},async created(){this.$robonomicsReady((async()=>{this.isReady=!0}))},methods:{handlerFindVideo({controller:t=null,cid:e=null}={}){this.videoController=t,this.videoCid=e},handlerAuth(t){this.ipfsAuth=t},handlerPlay({isLoad:t,content:e}){this.videoIsLoad=t,this.videoContent=e}}};const it=(0,O.Z)(ot,[["render",f]]);var st=it,rt={GATEWAY:"https://ipfs-gw.decloud.foundation"},at=n(4091);class ct{constructor(t){this.endpoint=t,this.authHeader=null}auth(t,e){const n=`sub-${t}:${e}`;this.authHeader=Buffer.from(n).toString("base64")}authClear(){this.authHeader=null}async ls(t){const e=(0,at.Ue)({url:this.endpoint,headers:{authorization:`Basic ${this.authHeader}`}}),n=[];for await(const o of e.ls(t))"file"===o.type&&n.push(o);return n}async cat(t){const e=(0,at.Ue)({url:this.endpoint,headers:{authorization:`Basic ${this.authHeader}`}}),n=async t=>{const n=new TextDecoder;let o="";for await(const i of e.cat(t))o+=n.decode(i,{stream:!0});return o};return await n(t)}}var lt={install:t=>{t.config.globalProperties.$ipfs=new ct(rt.GATEWAY)}},dt=n(2996),ut=n(7541),ht=n(6117),ft=n(142),pt=n(3102);function yt(){return new Promise((function(t,e){const n=setTimeout((()=>(clearTimeout(n),clearInterval(o),e(new Error("Not fount polkadot.extension")))),3e3),o=setInterval((()=>{if(Object.keys(window.injectedWeb3).length>0)return clearTimeout(n),clearInterval(o),t()}),100)}))}class gt extends k.Uk{async initPlugin(t={}){await yt();const e=await(0,ut.$y)("robonomics");if(0===e.length)throw new Error("Allow the browser extension to interact with dapp and try again.");const n=await(0,ut.vK)(),o=n.map((({address:t,meta:e})=>({address:t,meta:e})));await(0,pt.I)(),this.keyring.loadAll({...t},o),this.setReady(!0)}async afterSetSender(){if(this.api&&this.account)if(this.account.meta.isInjected&&this.account.meta.source){const t=await(0,ut.R0)(this.account.meta.source);this.api.setSigner(t.signer),this.account.signMsg=async e=>(await t.signer.signRaw({address:this.account.address,data:(0,ht.c)((0,ft.Rl)(e)),type:"bytes"})).signature}else this.account.signMsg=async t=>this.account?Promise.resolve((0,ht.c)(this.account.sign(t))):Promise.reject(new Error("not account"))}}async function wt(){try{return k.l.getInstance()}catch(t){}return await k.l.createInstance({endpoint:"wss://kusama.rpc.robonomics.network/"})}var vt={install:async t=>{let e,n=!1;t.config.globalProperties.$robonomicsReady=t=>{n?t():e=t},t.config.globalProperties.$robonomics=await wt(),t.config.globalProperties.$robonomics.setAccountManager(new gt(dt.ZP)),n=!0,e&&e()}};window.Buffer=o.lW;const mt=(0,i.ri)(st);mt.config.globalProperties.$ipfs_gateway=rt.GATEWAY,mt.use(vt).use(lt).mount("#app")},5856:function(){},6601:function(){},3897:function(){},5024:function(){}},e={};function n(o){var i=e[o];if(void 0!==i)return i.exports;var s=e[o]={id:o,loaded:!1,exports:{}};return t[o].call(s.exports,s,s.exports,n),s.loaded=!0,s.exports}n.m=t,function(){n.amdO={}}(),function(){var t=[];n.O=function(e,o,i,s){if(!o){var r=1/0;for(d=0;d<t.length;d++){o=t[d][0],i=t[d][1],s=t[d][2];for(var a=!0,c=0;c<o.length;c++)(!1&s||r>=s)&&Object.keys(n.O).every((function(t){return n.O[t](o[c])}))?o.splice(c--,1):(a=!1,s<r&&(r=s));if(a){t.splice(d--,1);var l=i();void 0!==l&&(e=l)}}return e}s=s||0;for(var d=t.length;d>0&&t[d-1][2]>s;d--)t[d]=t[d-1];t[d]=[o,i,s]}}(),function(){n.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return n.d(e,{a:e}),e}}(),function(){var t,e=Object.getPrototypeOf?function(t){return Object.getPrototypeOf(t)}:function(t){return t.__proto__};n.t=function(o,i){if(1&i&&(o=this(o)),8&i)return o;if("object"===typeof o&&o){if(4&i&&o.__esModule)return o;if(16&i&&"function"===typeof o.then)return o}var s=Object.create(null);n.r(s);var r={};t=t||[null,e({}),e([]),e(e)];for(var a=2&i&&o;"object"==typeof a&&!~t.indexOf(a);a=e(a))Object.getOwnPropertyNames(a).forEach((function(t){r[t]=function(){return o[t]}}));return r["default"]=function(){return o},n.d(s,r),s}}(),function(){n.d=function(t,e){for(var o in e)n.o(e,o)&&!n.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:e[o]})}}(),function(){n.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"===typeof window)return window}}()}(),function(){n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)}}(),function(){n.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}}(),function(){n.nmd=function(t){return t.paths=[],t.children||(t.children=[]),t}}(),function(){var t={143:0};n.O.j=function(e){return 0===t[e]};var e=function(e,o){var i,s,r=o[0],a=o[1],c=o[2],l=0;if(r.some((function(e){return 0!==t[e]}))){for(i in a)n.o(a,i)&&(n.m[i]=a[i]);if(c)var d=c(n)}for(e&&e(o);l<r.length;l++)s=r[l],n.o(t,s)&&t[s]&&t[s][0](),t[s]=0;return n.O(d)},o=self["webpackChunkvideostream"]=self["webpackChunkvideostream"]||[];o.forEach(e.bind(null,0)),o.push=e.bind(null,o.push.bind(o))}();var o=n.O(void 0,[998],(function(){return n(7662)}));o=n.O(o)})();
//# sourceMappingURL=app.d8646b9f.js.map